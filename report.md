# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by
[Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security
review. It should not be relied upon for any purpose other than to assist in the identification of potential security
vulnerabilities.

# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Unprotected initializer](#h-1-unprotected-initializer)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk for trusted owners](#l-1-centralization-risk-for-trusted-owners)
  - [L-2: Missing checks for `address(0)` when assigning values to address state variables](#l-2-missing-checks-for-address0-when-assigning-values-to-address-state-variables)
  - [L-3: Define and use `constant` variables instead of using literals](#l-3-define-and-use-constant-variables-instead-of-using-literals)
  - [L-4: Event is missing `indexed` fields](#l-4-event-is-missing-indexed-fields)
  - [L-5: Empty Block](#l-5-empty-block)
  - [L-6: Internal functions called only once can be inlined](#l-6-internal-functions-called-only-once-can-be-inlined)
  - [L-7: Contract still has TODOs](#l-7-contract-still-has-todos)
  - [L-8: Unused Custom Error](#l-8-unused-custom-error)

# Summary

## Files Summary

| Key         | Value |
| ----------- | ----- |
| .sol Files  | 24    |
| Total nSLOC | 2039  |

## Files Details

| Filepath                                                   | nSLOC    |
| ---------------------------------------------------------- | -------- |
| src/EOFeedManager.sol                                      | 164      |
| src/adapters/EOFeedAdapter.sol                             | 166      |
| src/adapters/EOFeedRegistryAdapter.sol                     | 7        |
| src/adapters/EOFeedRegistryAdapterBase.sol                 | 122      |
| src/adapters/EOFeedRegistryAdapterClone.sol                | 7        |
| src/adapters/factories/EOFeedFactoryBase.sol               | 11       |
| src/adapters/factories/EOFeedFactoryBeacon.sol             | 25       |
| src/adapters/factories/EOFeedFactoryClone.sol              | 16       |
| src/adapters/interfaces/IEOFeedAdapter.sol                 | 29       |
| src/adapters/interfaces/IEOFeedRegistryAdapter.sol         | 37       |
| src/common/BLS.sol                                         | 238      |
| src/common/BN256G2.sol                                     | 266      |
| src/common/BN256G2v1.sol                                   | 377      |
| src/common/Merkle.sol                                      | 29       |
| src/examples/EoracleConsumerExampleFeedAdapter.sol         | 17       |
| src/examples/EoracleConsumerExampleFeedManager.sol         | 28       |
| src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol | 21       |
| src/interfaces/Errors.sol                                  | 5        |
| src/interfaces/IBLS.sol                                    | 168      |
| src/interfaces/IBN256G2.sol                                | 16       |
| src/interfaces/IEOFeedManager.sol                          | 56       |
| src/interfaces/IEOFeedVerifier.sol                         | 97       |
| src/libraries/Denominations.sol                            | 88       |
| test/mock/MockEOFeedManager.sol                            | 49       |
| **Total**                                                  | **2039** |

## Issue Summary

| Category | No. of Issues |
| -------- | ------------- |
| High     | 1             |
| Low      | 8             |

# High Issues

## H-1: Unprotected initializer

Consider protecting the initializer functions with modifiers.

<details><summary>2 Found Instances</summary>

- Found in src/adapters/factories/EOFeedFactoryBase.sol [Line: 5](src/adapters/factories/EOFeedFactoryBase.sol#L5)

  ```solidity
      function __EOFeedFactory_init(address impl, address) internal virtual;
  ```

- Found in src/adapters/interfaces/IEOFeedAdapter.sol [Line: 13](src/adapters/interfaces/IEOFeedAdapter.sol#L13)

  ```solidity
      function initialize(
  ```

</details>

# Low Issues

## L-1: Centralization Risk for trusted owners

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious
updates or drain funds.

<details><summary>4 Found Instances</summary>

- Found in src/EOFeedManager.sol [Line: 41](src/EOFeedManager.sol#L41)

  ```solidity
      function setSupportedFeeds(uint16[] calldata feedIds, bool[] calldata isSupported) external onlyOwner {
  ```

- Found in src/EOFeedManager.sol [Line: 55](src/EOFeedManager.sol#L55)

  ```solidity
      function whitelistPublishers(address[] memory publishers, bool[] memory isWhitelisted) external onlyOwner {
  ```

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 43](src/adapters/EOFeedRegistryAdapterBase.sol#L43)

  ```solidity
      function setFeedManager(address feedManager) external onlyOwner {
  ```

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 72](src/adapters/EOFeedRegistryAdapterBase.sol#L72)

  ```solidity
          onlyOwner
  ```

</details>

## L-2: Missing checks for `address(0)` when assigning values to address state variables

Check for `address(0)` when assigning values to address state variables.

<details><summary>13 Found Instances</summary>

- Found in src/EOFeedManager.sol [Line: 32](src/EOFeedManager.sol#L32)

  ```solidity
          _feedVerifier = IEOFeedVerifier(feedVerifier);
  ```

- Found in src/EOFeedManager.sol [Line: 59](src/EOFeedManager.sol#L59)

  ```solidity
              _whitelistedPublishers[publishers[i]] = isWhitelisted[i];
  ```

- Found in src/adapters/EOFeedAdapter.sol [Line: 40](src/adapters/EOFeedAdapter.sol#L40)

  ```solidity
          _feedManager = feedManager;
  ```

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 34](src/adapters/EOFeedRegistryAdapterBase.sol#L34)

  ```solidity
          _feedManager = IEOFeedManager(feedManager);
  ```

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 45](src/adapters/EOFeedRegistryAdapterBase.sol#L45)

  ```solidity
          _feedManager = IEOFeedManager(feedManager);
  ```

- Found in src/adapters/factories/EOFeedFactoryBeacon.sol [Line: 24](src/adapters/factories/EOFeedFactoryBeacon.sol#L24)

  ```solidity
          _beacon = address(new UpgradeableBeacon(impl, initialOwner));
  ```

- Found in src/adapters/factories/EOFeedFactoryClone.sol [Line: 23](src/adapters/factories/EOFeedFactoryClone.sol#L23)

  ```solidity
          _feedImplementation = impl;
  ```

- Found in src/examples/EoracleConsumerExampleFeedAdapter.sol
  [Line: 12](src/examples/EoracleConsumerExampleFeedAdapter.sol#L12)

  ```solidity
          _feedAdapter = IEOFeedAdapter(feedAdapter);
  ```

- Found in src/examples/EoracleConsumerExampleFeedAdapter.sol
  [Line: 17](src/examples/EoracleConsumerExampleFeedAdapter.sol#L17)

  ```solidity
          _feedAdapter = IEOFeedAdapter(feedAdapter);
  ```

- Found in src/examples/EoracleConsumerExampleFeedManager.sol
  [Line: 12](src/examples/EoracleConsumerExampleFeedManager.sol#L12)

  ```solidity
          _feedManager = IEOFeedManager(feedManager);
  ```

- Found in src/examples/EoracleConsumerExampleFeedManager.sol
  [Line: 17](src/examples/EoracleConsumerExampleFeedManager.sol#L17)

  ```solidity
          _feedManager = IEOFeedManager(feedManager);
  ```

- Found in src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol
  [Line: 13](src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol#L13)

  ```solidity
          _feedRegistryAdapter = IEOFeedRegistryAdapter(feedRegistryAdapter);
  ```

- Found in src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol
  [Line: 18](src/examples/EoracleConsumerExampleFeedRegistryAdapter.sol#L18)

  ```solidity
          _feedRegistryAdapter = IEOFeedRegistryAdapter(feedRegistryAdapter);
  ```

</details>

## L-3: Define and use `constant` variables instead of using literals

If the same constant literal value is used multiple times, create a constant state variable and reference it throughout
the contract.

<details><summary>62 Found Instances</summary>

- Found in src/common/BLS.sol [Line: 766](src/common/BLS.sol#L766)

  ```solidity
          uint256[4] calldata pubkey,
  ```

- Found in src/common/BLS.sol [Line: 806](src/common/BLS.sol#L806)

  ```solidity
          uint256[4][] calldata pubkeys,
  ```

- Found in src/common/BLS.sol [Line: 819](src/common/BLS.sol#L819)

  ```solidity
          uint256 inputSize = (size + 1) * 6;
  ```

- Found in src/common/BLS.sol [Line: 829](src/common/BLS.sol#L829)

  ```solidity
              input[i * 6 + 6] = messages[i][0];
  ```

- Found in src/common/BLS.sol [Line: 830](src/common/BLS.sol#L830)

  ```solidity
              input[i * 6 + 7] = messages[i][1];
  ```

- Found in src/common/BLS.sol [Line: 831](src/common/BLS.sol#L831)

  ```solidity
              input[i * 6 + 8] = pubkeys[i][1];
  ```

- Found in src/common/BLS.sol [Line: 832](src/common/BLS.sol#L832)

  ```solidity
              input[i * 6 + 9] = pubkeys[i][0];
  ```

- Found in src/common/BLS.sol [Line: 833](src/common/BLS.sol#L833)

  ```solidity
              input[i * 6 + 10] = pubkeys[i][3];
  ```

- Found in src/common/BLS.sol [Line: 834](src/common/BLS.sol#L834)

  ```solidity
              input[i * 6 + 11] = pubkeys[i][2];
  ```

- Found in src/common/BLS.sol [Line: 853](src/common/BLS.sol#L853)

  ```solidity
          uint256[4][] calldata pubkeys,
  ```

- Found in src/common/BLS.sol [Line: 863](src/common/BLS.sol#L863)

  ```solidity
          uint256 inputSize = (size + 1) * 6;
  ```

- Found in src/common/BLS.sol [Line: 873](src/common/BLS.sol#L873)

  ```solidity
              input[i * 6 + 6] = message[0];
  ```

- Found in src/common/BLS.sol [Line: 874](src/common/BLS.sol#L874)

  ```solidity
              input[i * 6 + 7] = message[1];
  ```

- Found in src/common/BLS.sol [Line: 875](src/common/BLS.sol#L875)

  ```solidity
              input[i * 6 + 8] = pubkeys[i][1];
  ```

- Found in src/common/BLS.sol [Line: 876](src/common/BLS.sol#L876)

  ```solidity
              input[i * 6 + 9] = pubkeys[i][0];
  ```

- Found in src/common/BLS.sol [Line: 877](src/common/BLS.sol#L877)

  ```solidity
              input[i * 6 + 10] = pubkeys[i][3];
  ```

- Found in src/common/BLS.sol [Line: 878](src/common/BLS.sol#L878)

  ```solidity
              input[i * 6 + 11] = pubkeys[i][2];
  ```

- Found in src/common/BLS.sol [Line: 900](src/common/BLS.sol#L900)

  ```solidity
          uint256[4] memory bnAddInput;
  ```

- Found in src/common/BLS.sol [Line: 928](src/common/BLS.sol#L928)

  ```solidity
          a0 = addmod(a0, 4, N);
  ```

- Found in src/common/BLS.sol [Line: 942](src/common/BLS.sol#L942)

  ```solidity
          a1 = addmod(a1, 3, N);
  ```

- Found in src/common/BLS.sol [Line: 957](src/common/BLS.sol#L957)

  ```solidity
          a1 = addmod(a1, 3, N);
  ```

- Found in src/common/BLS.sol [Line: 975](src/common/BLS.sol#L975)

  ```solidity
          a1 = addmod(a1, 3, N);
  ```

- Found in src/common/BLS.sol [Line: 1016](src/common/BLS.sol#L1016)

  ```solidity
      function isOnCurveG2(uint256[4] memory point) external pure returns (bool _isOnCurve) {
  ```

- Found in src/common/BLS.sol [Line: 1102](src/common/BLS.sol#L1102)

  ```solidity
          bytes memory msg0 = new bytes(32 + t0 + 64 + 4);
  ```

- Found in src/common/BLS.sol [Line: 1124](src/common/BLS.sol#L1124)

  ```solidity
          t0 = 32 + 34;
  ```

- Found in src/common/BN256G2.sol [Line: 73](src/common/BN256G2.sol#L73)

  ```solidity
          uint256[6] memory pt3 = ecTwistAddJacobian(pt1xx, pt1xy, pt1yx, pt1yy, 1, 0, pt2xx, pt2xy, pt2yx, pt2yy, 1, 0);
  ```

- Found in src/common/BN256G2.sol [Line: 106](src/common/BN256G2.sol#L106)

  ```solidity
          uint256[6] memory pt2 = _ecTwistMulJacobian(s, pt1xx, pt1xy, pt1yx, pt1yy, pt1zx, 0);
  ```

- Found in src/common/BN256G2.sol [Line: 295](src/common/BN256G2.sol#L295)

  ```solidity
          uint256[4] memory pt2;
  ```

- Found in src/common/BN256G2.sol [Line: 335](src/common/BN256G2.sol#L335)

  ```solidity
          returns (uint256[6] memory pt3)
  ```

- Found in src/common/BN256G2.sol [Line: 406](src/common/BN256G2.sol#L406)

  ```solidity
          uint256[6] memory pt2;
  ```

- Found in src/common/BN256G2.sol [Line: 413](src/common/BN256G2.sol#L413)

  ```solidity
          (pt2[4], pt2[5]) = _fq2muc(pt2[2], pt2[3], 8); // 8 * B
  ```

- Found in src/common/BN256G2.sol [Line: 416](src/common/BN256G2.sol#L416)

  ```solidity
          (pt2[2], pt2[3]) = _fq2muc(pt2[2], pt2[3], 4); // 4 * B
  ```

- Found in src/common/BN256G2.sol [Line: 419](src/common/BN256G2.sol#L419)

  ```solidity
          (pt2[0], pt2[1]) = _fq2muc(pt1yx, pt1yy, 8); // 8 * y
  ```

- Found in src/common/BN256G2.sol [Line: 426](src/common/BN256G2.sol#L426)

  ```solidity
          (pt2[4], pt2[5]) = _fq2muc(pt2[4], pt2[5], 8); // newz = 8 * S * S_squared
  ```

- Found in src/common/BN256G2.sol [Line: 454](src/common/BN256G2.sol#L454)

  ```solidity
          returns (uint256[6] memory pt2)
  ```

- Found in src/common/BN256G2v1.sol [Line: 73](src/common/BN256G2v1.sol#L73)

  ```solidity
          uint256[6] memory pt3 = ecTwistAddJacobian(pt1xx, pt1xy, pt1yx, pt1yy, 1, 0, pt2xx, pt2xy, pt2yx, pt2yy, 1, 0);
  ```

- Found in src/common/BN256G2v1.sol [Line: 106](src/common/BN256G2v1.sol#L106)

  ```solidity
          uint256[6] memory pt2 = _ecTwistMulJacobian(s, pt1xx, pt1xy, pt1yx, pt1yy, pt1zx, 0);
  ```

- Found in src/common/BN256G2v1.sol [Line: 291](src/common/BN256G2v1.sol#L291)

  ```solidity
          uint256[4] memory pt2;
  ```

- Found in src/common/BN256G2v1.sol [Line: 331](src/common/BN256G2v1.sol#L331)

  ```solidity
          returns (uint256[6] memory pt3)
  ```

- Found in src/common/BN256G2v1.sol [Line: 402](src/common/BN256G2v1.sol#L402)

  ```solidity
          uint256[6] memory pt2;
  ```

- Found in src/common/BN256G2v1.sol [Line: 409](src/common/BN256G2v1.sol#L409)

  ```solidity
          (pt2[4], pt2[5]) = _fq2muc(pt2[2], pt2[3], 8); // 8 * B
  ```

- Found in src/common/BN256G2v1.sol [Line: 412](src/common/BN256G2v1.sol#L412)

  ```solidity
          (pt2[2], pt2[3]) = _fq2muc(pt2[2], pt2[3], 4); // 4 * B
  ```

- Found in src/common/BN256G2v1.sol [Line: 415](src/common/BN256G2v1.sol#L415)

  ```solidity
          (pt2[0], pt2[1]) = _fq2muc(pt1yx, pt1yy, 8); // 8 * y
  ```

- Found in src/common/BN256G2v1.sol [Line: 422](src/common/BN256G2v1.sol#L422)

  ```solidity
          (pt2[4], pt2[5]) = _fq2muc(pt2[4], pt2[5], 8); // newz = 8 * S * S_squared
  ```

- Found in src/common/BN256G2v1.sol [Line: 450](src/common/BN256G2v1.sol#L450)

  ```solidity
          returns (uint256[6] memory pt2)
  ```

- Found in src/interfaces/IBLS.sol [Line: 15](src/interfaces/IBLS.sol#L15)

  ```solidity
          uint256[4] calldata pubkey,
  ```

- Found in src/interfaces/IBLS.sol [Line: 32](src/interfaces/IBLS.sol#L32)

  ```solidity
          uint256[4][] calldata pubkeys,
  ```

- Found in src/interfaces/IBLS.sol [Line: 49](src/interfaces/IBLS.sol#L49)

  ```solidity
          uint256[4][] calldata pubkeys,
  ```

- Found in src/interfaces/IBLS.sol [Line: 100](src/interfaces/IBLS.sol#L100)

  ```solidity
      function isOnCurveG2(uint256[4] memory point) external pure returns (bool _isOnCurve);
  ```

</details>

## L-4: Event is missing `indexed` fields

Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each
index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three
fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly
of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

<details><summary>4 Found Instances</summary>

- Found in src/adapters/EOFeedRegistryAdapterBase.sol [Line: 22](src/adapters/EOFeedRegistryAdapterBase.sol#L22)

  ```solidity
      event FeedAdapterDeployed(uint16 indexed feedId, address indexed feedAdapter, address base, address quote);
  ```

- Found in src/interfaces/IEOFeedManager.sol [Line: 13](src/interfaces/IEOFeedManager.sol#L13)

  ```solidity
      event RateUpdated(uint16 feedId, uint256 rate, uint256 timestamp);
  ```

- Found in src/interfaces/IEOFeedVerifier.sol [Line: 30](src/interfaces/IEOFeedVerifier.sol#L30)

  ```solidity
      event ValidatorSetUpdated(
  ```

- Found in src/interfaces/IEOFeedVerifier.sol [Line: 33](src/interfaces/IEOFeedVerifier.sol#L33)

  ```solidity
      event FeedManagerSet(address feedManager);
  ```

</details>

## L-5: Empty Block

Consider removing empty blocks.

<details><summary>1 Found Instances</summary>

- Found in test/mock/MockEOFeedManager.sol [Line: 55](test/mock/MockEOFeedManager.sol#L55)

  ```solidity
      function whitelistPublishers(address[] memory, bool[] memory) external { }
  ```

</details>

## L-6: Internal functions called only once can be inlined

Instead of separating the logic into a separate function, consider inlining the logic into the calling function. This
can reduce the number of function calls and improve readability.

<details><summary>1 Found Instances</summary>

- Found in src/common/BLS.sol [Line: 1067](src/common/BLS.sol#L1067)

  ```solidity
      function inverse(uint256 a) internal pure returns (uint256) {
  ```

</details>

## L-7: Contract still has TODOs

Contract contains comments with TODOS

<details><summary>2 Found Instances</summary>

- Found in src/EOFeedManager.sol [Line: 10](src/EOFeedManager.sol#L10)

  ```solidity
  contract EOFeedManager is Initializable, OwnableUpgradeable, IEOFeedManager {
  ```

- Found in src/adapters/factories/EOFeedFactoryBeacon.sol [Line: 9](src/adapters/factories/EOFeedFactoryBeacon.sol#L9)

  ```solidity
  abstract contract EOFeedFactoryBeacon is Initializable, EOFeedFactoryBase {
  ```

</details>

## L-8: Unused Custom Error

it is recommended that the definition be removed when custom error is unused

<details><summary>9 Found Instances</summary>

- Found in src/interfaces/Errors.sol [Line: 15](src/interfaces/Errors.sol#L15)

  ```solidity
  error CallerIsNotFeedManager();
  ```

- Found in src/interfaces/Errors.sol [Line: 16](src/interfaces/Errors.sol#L16)

  ```solidity
  error InvalidProof();
  ```

- Found in src/interfaces/Errors.sol [Line: 17](src/interfaces/Errors.sol#L17)

  ```solidity
  error InvalidAddress();
  ```

- Found in src/interfaces/Errors.sol [Line: 18](src/interfaces/Errors.sol#L18)

  ```solidity
  error InvalidValidatorSetHash();
  ```

- Found in src/interfaces/Errors.sol [Line: 19](src/interfaces/Errors.sol#L19)

  ```solidity
  error InvalidEventRoot();
  ```

- Found in src/interfaces/Errors.sol [Line: 20](src/interfaces/Errors.sol#L20)

  ```solidity
  error VotingPowerIsZero();
  ```

- Found in src/interfaces/Errors.sol [Line: 21](src/interfaces/Errors.sol#L21)

  ```solidity
  error AggVotingPowerIsZero();
  ```

- Found in src/interfaces/Errors.sol [Line: 22](src/interfaces/Errors.sol#L22)

  ```solidity
  error InsufficientVotingPower();
  ```

- Found in src/interfaces/Errors.sol [Line: 23](src/interfaces/Errors.sol#L23)

  ```solidity
  error SignatureVerficationFailed();
  ```

</details>
